/*! @name videojs-dailymotion @version 1.0.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self).videojsDailymotion=t(e.videojs)}(this,function(e){"use strict";var t,i,o,a,n,s,r,d,l=(e=e&&e.hasOwnProperty("default")?e.default:e).browser.IS_IOS||e.browser.IS_NATIVE_ANDROID,u=e.getComponent("Tech"),c=function(t){var i,o;function a(e,i){var o;return(o=t.call(this,e,i)||this).dailymotionInfo={source:"",state:"unstarted",isSeeking:!1},o.setPoster(e.poster),o.setSrc(o.options_.source.src),o.setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-dailymotion",l&&(this.el_.parentNode.className+=" vjs-dailymotion-mobile"),e.poster||(this.el_.parentNode.className+=" vjs-no-poster"),a.isApiReady?this.initDailymotionPlayer():a.apiReadyQueue.push(this))}.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o))),o}o=t,(i=a).prototype=Object.create(o.prototype),i.prototype.constructor=i,i.__proto__=o;var n=a.prototype;return n.dispose=function(){if(this.dailymotionPlayer)DM.destroy(this.options_.techId);else{var e=a.apiReadyQueue.indexOf(this);-1!==e&&a.apiReadyQueue.splice(e,1)}this.dailymotionPlayer=null,this.el_.parentNode.className=this.el_.parentNode.className.replace(" vjs-dailymotion","").replace(" vjs-dailymotion-mobile","").replace(" vjs-no-poster",""),this.el_.parentNode.removeChild(this.el_),t.prototype.dispose.call(this)},n.createEl=function(){var e=document.createElement("div");e.setAttribute("id",this.options_.techId),e.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),e.setAttribute("class","vjs-tech");var t=document.createElement("div");if(t.appendChild(e),!l&&!this.options_.dailymotionControls){var i=document.createElement("div");i.setAttribute("class","vjs-iframe-blocker"),i.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),i.onclick=function(){this.pause()}.bind(this),t.appendChild(i)}return t},n.initDailymotionPlayer=function(){var e={controls:!0,"ui-logo":!1,"ui-start-screen-info":!1,"sharing-enable":!1,mute:!1,start:0};void 0!==this.options_.muted&&(e.mute=!!this.options_.muted),void 0!==this.options_.start&&(e.start=this.options_.start),this.dailymotionPlayer=DM.player(this.options_.techId,{video:this.dailymotionInfo.source.videoId,params:e}),this.trigger("loadstart");for(var t=["playback_ready","start","durationchange","volumechange","waiting","progress","timeupdate","play","playing","pause","seeking","seeked","ad_play","ad_pause","ad_timeupdate","end","error"],i=this.onStateChange.bind(this),o=0;o<t.length;o++)this.dailymotionPlayer.addEventListener(t[o],i)},n.onPlayerReady=function(){this.isReady_=!0,this.triggerReady(),this.trigger("loadedmetadata"),this.trigger("loadeddata"),this.trigger("canplay"),this.trigger("volumechange"),this.playOnReady&&this.play()},n.onStateChange=function(e){switch(e.type){case"playback_ready":this.onPlayerReady();break;case"start":this.dailymotionPlayer.setControls(!1);break;case"durationchange":this.trigger("durationchange");break;case"volumechange":this.trigger("volumechange");break;case"waiting":this.dailymotionInfo.state="buffering",this.trigger("waiting");break;case"progress":this.trigger("progress");break;case"timeupdate":case"ad_timeupdate":this.trigger("timeupdate");break;case"play":case"ad_play":this.dailymotionInfo.state="playing",this.trigger("play");break;case"playing":this.dailymotionInfo.state="playing",this.trigger("playing");break;case"pause":case"ad_pause":this.dailymotionInfo.state="paused",this.trigger("pause");break;case"seeking":this.dailymotionInfo.isSeeking=!0,this.trigger("seeking");break;case"seeked":this.dailymotionInfo.isSeeking=!1,this.trigger("seeked");break;case"end":this.options_.loop?this.setCurrentTime(0):(this.dailymotionInfo.state="ended",this.trigger("ended"));break;case"error":console.log(error)}},n.poster=function(){return this.poster_},n.setPoster=function(e){this.poster_=e},n.src=function(e){if(void 0===e)return this.options_.source;this.setSrc(e)},n.setSrc=function(e){e&&(this.dailymotionInfo.source=a.parseUrl(e),this.options_.autoplay&&!l&&this.play())},n.currentSrc=function(){return this.options_.source.src},n.play=function(){this.isReady_?this.dailymotionPlayer.play():(this.trigger("waiting"),this.playOnReady=!0)},n.pause=function(){this.dailymotionPlayer&&this.dailymotionPlayer.pause()},n.paused=function(){return"playing"!==this.dailymotionInfo.state&&"buffering"!==this.dailymotionInfo.state},n.currentTime=function(){return this.dailymotionPlayer?this.dailymotionPlayer.currentTime:0},n.setCurrentTime=function(e){this.dailymotionPlayer&&(this.dailymotionPlayer.seek(e),this.trigger("timeupdate"))},n.duration=function(){return this.dailymotionPlayer?this.dailymotionPlayer.duration:0},n.buffered=function(){return this.dailymotionPlayer?e.createTimeRange(0,this.dailymotionPlayer.bufferedTime):e.createTimeRange()},n.seeking=function(){return this.dailymotionInfo.isSeeking},n.seekable=function(){return this.dailymotionPlayer?e.createTimeRange(0,this.dailymotionPlayer.duration):e.createTimeRange()},n.volume=function(){return this.dailymotionPlayer?this.dailymotionPlayer.volume:1},n.setVolume=function(e){this.dailymotionPlayer&&this.dailymotionPlayer.setVolume(e)},n.muted=function(){return!!this.dailymotionPlayer&&this.dailymotionPlayer.muted},n.setMuted=function(e){this.dailymotionPlayer&&this.dailymotionPlayer.setMuted(e)},n.ended=function(){return"ended"===this.dailymotionInfo.state},n.playbackRate=function(){return 1},n.supportsFullScreen=function(){return!0},a}(u);return c.prototype.featuresProgressEvents=!0,c.prototype.featuresTimeupdateEvents=!0,c.isSupported=function(){return!0},c.parseUrl=function(e){var t={videoId:null},i=e.match(/^.+dailymotion.com\/((video|hub)\/([^_]+))?[^#]*(#video=([^_&]+))?/);return i&&(t.videoId=i[5]||i[3]),t},u.withSourceHandlers(c),c.nativeSourceHandler={},c.nativeSourceHandler.canPlayType=function(e){return"video/dailymotion"===e?"maybe":""},c.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return c.nativeSourceHandler.canPlayType(e.type);if(e.src){var i=/dailymotion.com/.test(e.src)?"video/dailymotion":"";return c.nativeSourceHandler.canPlayType(i)}return""},c.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},c.nativeSourceHandler.dispose=function(){},c.registerSourceHandler(c.nativeSourceHandler),c.apiReadyQueue=[],"undefined"!=typeof document&&(a="https://api.dmcdn.net/all.js",n=function(){DM.init({apiKey:null,status:!0,cookie:!0}),c.isApiReady=!0;for(var e=0;e<c.apiReadyQueue.length;++e)c.apiReadyQueue[e].initDailymotionPlayer()},s=!1,r=document.createElement("script"),(d=document.getElementsByTagName("script")[0]).parentNode.insertBefore(r,d),r.onload=function(){s||(s=!0,n())},r.onreadystatechange=function(){s||"complete"!==this.readyState&&"loaded"!==this.readyState||(s=!0,n())},r.src=a,t=".vjs-dailymotion iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }.vjs-dailymotion .vjs-iframe-blocker { display: none; }.vjs-dailymotion.vjs-has-started.vjs-user-inactive .vjs-iframe-blocker { display: block; }.vjs-dailymotion:not(.vjs-has-started) .vjs-poster, .vjs-dailymotion:not(.vjs-has-started) .vjs-big-play-button { pointer-events: none; }.vjs-dailymotion .vjs-poster { background-size: cover; }.vjs-no-poster:not(.vjs-ended) .vjs-big-play-button { display: none; }",i=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("style")).type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)),i.appendChild(o)),c.VERSION="1.0.0",u.registerTech("Dailymotion",c),c});
