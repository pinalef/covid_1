/*! @name videojs-vimeo2 @version 1.0.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self).videojsVimeo2=t(e.videojs)}(this,function(e){"use strict";var t,i,o,n,r,s,a,u,c=(e=e&&e.hasOwnProperty("default")?e.default:e).browser.IS_IOS||e.browser.IS_NATIVE_ANDROID,h=e.getComponent("Tech"),d=function(t){var i,o;function n(e,i){var o;return(o=t.call(this,e,i)||this).vimeoInfo={source:"",state:"unstarted",volume:1,muted:!!o.options_.muted,muteVolume:1,buffered:0,currentTime:0,duration:0,isSeeking:!1,error:null},o.setPoster(e.poster),o.setSrc(o.options_.source.src),o.setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-vimeo",c&&(this.el_.parentNode.className+=" vjs-vimeo-mobile"),n.isApiReady?this.initVimeoPlayer():n.apiReadyQueue.push(this))}.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o))),o}o=t,(i=n).prototype=Object.create(o.prototype),i.prototype.constructor=i,i.__proto__=o;var r=n.prototype;return r.dispose=function(){if(this.vimeoPlayer)this.vimeoPlayer.unload().then(function(){}).catch(function(e){this.onError(e)}),this.vimeoPlayer.destroy().then(function(){}).catch(function(e){this.onError(e)});else{var e=n.apiReadyQueue.indexOf(this);-1!==e&&n.apiReadyQueue.splice(e,1)}this.vimeoPlayer=null,this.el_.parentNode.className=this.el_.parentNode.className.replace(" vjs-vimeo","").replace(" vjs-vimeo-mobile",""),this.el_.parentNode.removeChild(this.el_),t.prototype.dispose.call(this)},r.createEl=function(){var e=document.createElement("div");e.setAttribute("id",this.options_.techId),e.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),e.setAttribute("class","vjs-tech");var t=document.createElement("div");if(t.appendChild(e),!c&&!this.options_.vimeoControls){var i=document.createElement("div");i.setAttribute("class","vjs-iframe-blocker"),i.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),t.appendChild(i)}return t},r.initVimeoPlayer=function(){var e=this,t={id:this.vimeoInfo.source.videoId,byline:!1,controls:!1,portrait:!1,title:!1};void 0!==this.options_.byline&&(t.byline=!!this.options_.byline),void 0!==this.options_.color&&(t.color=this.options_.color.replace(/^#/,"")),void 0!==this.options_.vimeoControls&&(t.controls=!!this.options_.vimeoControls),void 0!==this.options_.muted&&(t.muted=!!this.options_.muted),void 0!==this.options_.loop&&(t.loop=!!this.options_.loop),void 0!==this.options_.playsinline&&(t.playsinline=!!this.options_.playsinline),void 0!==this.options_.portrait&&(t.portrait=!!this.options_.portrait),void 0!==this.options_.title&&(t.title=!!this.options_.title),this.vimeoPlayer=new Vimeo.Player(this.options_.techId,t),this.trigger("loadstart"),this.vimeoPlayer.ready().then(function(){e.onPlayerReady();["bufferstart","progress","timeupdate","seeking","seeked","play","pause","ended","volumechange"].forEach(function(t){e.vimeoPlayer.on(t,function(i){return e.onStateChange(t,i)})})})},r.onPlayerReady=function(){this.isReady_=!0,this.triggerReady(),this.trigger("loadedmetadata"),this.trigger("loadeddata"),this.trigger("canplay"),this.trigger("volumechange"),this.playOnReady&&this.play()},r.onStateChange=function(e,t){switch(void 0!==t.duration&&this.vimeoInfo.duration!==t.duration&&(this.vimeoInfo.duration=t.duration,this.trigger("durationchange")),e){case"bufferstart":this.vimeoInfo.state="buffering";break;case"progress":this.vimeoInfo.buffered=t.percent,this.trigger("progress");break;case"timeupdate":this.vimeoInfo.currentTime=t.seconds,this.trigger("timeupdate");break;case"seeking":this.vimeoInfo.isSeeking=!0,this.trigger("seeking");break;case"seeked":this.vimeoInfo.isSeeking=!1,this.trigger("seeked");break;case"play":this.vimeoInfo.state="playing",this.trigger("play"),this.trigger("playing");break;case"pause":this.vimeoInfo.state="paused",this.trigger("pause");break;case"ended":this.vimeoInfo.state="ended",this.trigger("ended");break;case"volumechange":this.trigger("volumechange")}},r.onError=function(e){this.vimeoInfo.error=e,console.log(e)},r.poster=function(){return this.poster_},r.setPoster=function(e){this.poster_=e,this.trigger("posterchange")},r.src=function(e){if(void 0===e)return this.options_.source;this.setSrc(e)},r.setSrc=function(e){e&&(this.vimeoInfo.error=null,this.vimeoInfo.source=n.parseUrl(e),this.options_.autoplay&&!c&&this.play())},r.currentSrc=function(){return this.options_.source.src},r.play=function(){var e=this;this.isReady_?this.vimeoPlayer.play().then(function(){}).catch(function(t){e.onError(t)}):this.playOnReady=!0},r.pause=function(){var e=this;this.vimeoPlayer&&this.vimeoPlayer.pause().then(function(){}).catch(function(t){e.onError(t)})},r.paused=function(){return"playing"!==this.vimeoInfo.state&&"buffering"!==this.vimeoInfo.state},r.currentTime=function(){return this.vimeoInfo.currentTime},r.setCurrentTime=function(e){var t=this;this.vimeoPlayer&&(this.vimeoInfo.currentTime=e,this.vimeoPlayer.setCurrentTime(e).then(function(){t.vimeoInfo.currentTime=e}).catch(function(e){t.onError(e)}),this.trigger("timeupdate"))},r.duration=function(){return this.vimeoInfo.duration},r.buffered=function(){return e.createTimeRange(0,this.vimeoInfo.buffered*this.vimeoInfo.duration)},r.seeking=function(){return this.vimeoInfo.isSeeking},r.seekable=function(){return e.createTimeRange(0,this.vimeoInfo.duration)},r.volume=function(){return this.vimeoInfo.muted?this.vimeoInfo.muteVolume:this.vimeoInfo.volume},r.setVolume=function(e){var t=this;this.vimeoPlayer&&("unstarted"==this.vimeoInfo.state&&this.vimeoInfo.muted||this.vimeoPlayer.setVolume(e).then(function(){t.vimeoInfo.volume=e}).catch(function(e){t.onError(e)}))},r.muted=function(){return this.vimeoInfo.muted},r.setMuted=function(e){e?(this.vimeoInfo.muteVolume=this.vimeoInfo.volume,this.setVolume(0)):this.setVolume(this.vimeoInfo.muteVolume),this.vimeoInfo.muted=e},r.ended=function(){return"ended"===this.vimeoInfo.state},r.playbackRate=function(){return 1},r.supportsFullScreen=function(){return!0},n}(h);return d.prototype.featuresProgressEvents=!0,d.prototype.featuresTimeupdateEvents=!0,d.isSupported=function(){return!0},d.parseUrl=function(e){var t={videoId:null},i=e.match(/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/);return i&&(t.videoId=i[5]),t},h.withSourceHandlers(d),d.nativeSourceHandler={},d.nativeSourceHandler.canPlayType=function(e){return"video/vimeo"===e?"maybe":""},d.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return d.nativeSourceHandler.canPlayType(e.type);if(e.src){var i=/vimeo.com/.test(e.src)?"video/vimeo":"";return d.nativeSourceHandler.canPlayType(i)}return""},d.nativeSourceHandler.handleSource=function(e,t,i){t.setSrc(e.src)},d.nativeSourceHandler.dispose=function(){},d.registerSourceHandler(d.nativeSourceHandler),d.apiReadyQueue=[],"undefined"!=typeof document&&(n="https://player.vimeo.com/api/player.js",r=function(){d.isApiReady=!0;for(var e=0;e<d.apiReadyQueue.length;++e)d.apiReadyQueue[e].initVimeoPlayer()},s=!1,a=document.createElement("script"),(u=document.getElementsByTagName("script")[0]).parentNode.insertBefore(a,u),a.onload=function(){s||(s=!0,r())},a.onreadystatechange=function(){s||"complete"!==this.readyState&&"loaded"!==this.readyState||(s=!0,r())},a.src=n,t=".vjs-vimeo iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }.vjs-vimeo .vjs-poster { background-size: cover; }",i=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("style")).type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)),i.appendChild(o)),d.VERSION="1.0.0",h.registerTech("Vimeo2",d),d});
