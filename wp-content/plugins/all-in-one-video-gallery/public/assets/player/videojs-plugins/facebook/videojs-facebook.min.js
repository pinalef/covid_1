/*! @name videojs-facebook @version 1.0.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self).videojsFacebook=t(e.videojs)}(this,function(e){"use strict";var t,o,i,n,a,s,r,c,u=(e=e&&e.hasOwnProperty("default")?e.default:e).browser.IS_IOS||e.browser.IS_NATIVE_ANDROID,f=e.getComponent("Tech"),d=function(t){var o,i;function n(e,o){var i;return(i=t.call(this,e,o)||this).facebookInfo={source:"",state:"unstarted",volume:1,muted:!!i.options_.muted,duration:0,isSeeking:!1},i.setPoster(e.poster),i.setSrc(i.options_.source.src),i.setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-facebook",u&&(this.el_.parentNode.className+=" vjs-facebook-mobile"),e.poster||(this.el_.parentNode.className+=" vjs-no-poster"),n.isApiReady?this.initFacebookPlayer():n.apiReadyQueue.push(this))}.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i))),i}i=t,(o=n).prototype=Object.create(i.prototype),o.prototype.constructor=o,o.__proto__=i;var a=n.prototype;return a.dispose=function(){if(this.facebookPlayer)DM.destroy(this.options_.techId);else{var e=n.apiReadyQueue.indexOf(this);-1!==e&&n.apiReadyQueue.splice(e,1)}this.facebookPlayer=null,this.el_.parentNode.className=this.el_.parentNode.className.replace(" vjs-facebook","").replace(" vjs-facebook-mobile","").replace(" vjs-no-poster",""),this.el_.parentNode.removeChild(this.el_),t.prototype.dispose.call(this)},a.createEl=function(){var e=document.createElement("div");e.setAttribute("id",this.options_.techId),e.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),e.setAttribute("class","fb-video vjs-tech"),e.setAttribute("data-href",this.options_.source.src),e.setAttribute("data-allowfullscreen",!0),e.setAttribute("data-controls",!1);var t=document.createElement("div");if(t.appendChild(e),!u&&!this.options_.facebookControls){var o=document.createElement("div");o.setAttribute("class","vjs-iframe-blocker"),o.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),o.onclick=function(){this.pause()}.bind(this),t.appendChild(o)}return t},a.initFacebookPlayer=function(){var e=this;this.facebookPlayer=null,FB.Event.subscribe("xfbml.ready",function(t){"video"===t.type&&t.id===e.options_.techId&&(e.facebookPlayer=t.instance,e.trigger("loadstart"),e.onPlayerReady(),e.facebookPlayer.subscribe("startedBuffering",function(t){e.onStateChange("startedBuffering")}),e.facebookPlayer.subscribe("finishedBuffering",function(t){e.onStateChange("finishedBuffering")}),e.facebookPlayer.subscribe("startedPlaying",function(t){e.onStateChange("startedPlaying")}),e.facebookPlayer.subscribe("paused",function(t){e.onStateChange("paused")}),e.facebookPlayer.subscribe("finishedPlaying",function(t){e.onStateChange("finishedPlaying")}),e.facebookPlayer.subscribe("error",function(t){e.onStateChange("error")}))})},a.onPlayerReady=function(){this.facebookInfo.muted=this.facebookPlayer.isMuted(),this.isReady_=!0,this.triggerReady(),this.trigger("loadedmetadata"),this.trigger("loadeddata"),this.trigger("canplay"),this.trigger("volumechange"),this.playOnReady&&this.play()},a.onStateChange=function(e){switch(e){case"startedBuffering":this.facebookInfo.state="buffering";break;case"finishedBuffering":break;case"startedPlaying":this.facebookInfo.state="playing",this.trigger("play"),this.trigger("playing"),this.facebookInfo.isSeeking&&this.onSeeked();break;case"paused":this.facebookInfo.state="paused",this.trigger("pause");break;case"finishedPlaying":this.options_.loop?this.facebookPlayer.play():(this.facebookInfo.state="ended",this.trigger("ended"));break;case"error":console.log("error")}},a.poster=function(){return this.poster_},a.setPoster=function(e){this.poster_=e},a.src=function(e){if(void 0===e)return this.options_.source;this.setSrc(e)},a.setSrc=function(e){e&&(this.facebookInfo.source={src:e},this.options_.autoplay&&!u&&this.play())},a.currentSrc=function(){return this.options_.source.src},a.play=function(){this.isReady_?this.facebookPlayer.play():(this.trigger("waiting"),this.playOnReady=!0)},a.pause=function(){this.facebookPlayer&&this.facebookPlayer.pause()},a.paused=function(){return"playing"!==this.facebookInfo.state&&"buffering"!==this.facebookInfo.state},a.currentTime=function(){return this.facebookPlayer?this.facebookPlayer.getCurrentPosition():0},a.setCurrentTime=function(e){this.facebookPlayer&&(this.facebookPlayer.seek(e),this.trigger("timeupdate"),this.facebookInfo.isSeeking=!0,this.trigger("seeking"))},a.duration=function(){var e=this;if(0===this.facebookInfo.duration){this.on("timeupdate",function t(){e.facebookInfo.duration=e.facebookPlayer.getDuration(),e.facebookInfo.duration>0&&(e.trigger("durationchange"),e.off("timeupdate",t))})}return this.facebookInfo.duration},a.buffered=function(){return e.createTimeRange()},a.seeking=function(){return this.facebookInfo.isSeeking},a.seekable=function(){return e.createTimeRange(0,this.facebookInfo.duration)},a.onSeeked=function(){this.facebookInfo.isSeeking=!1,this.trigger("seeked")},a.volume=function(){return this.facebookInfo.volume},a.setVolume=function(e){this.facebookPlayer&&(this.facebookPlayer.setVolume(e),this.facebookInfo.volume=e,this.trigger("volumechange"))},a.muted=function(){return this.facebookInfo.muted},a.setMuted=function(e){this.facebookPlayer&&(e?this.facebookPlayer.mute():this.facebookPlayer.unmute(),this.facebookInfo.muted=e,this.trigger("volumechange"))},a.ended=function(){return"ended"===this.facebookInfo.state},a.playbackRate=function(){return 1},a.supportsFullScreen=function(){return!0},n}(f);if(d.isSupported=function(){return!0},f.withSourceHandlers(d),d.nativeSourceHandler={},d.nativeSourceHandler.canPlayType=function(e){return"video/facebook"===e?"maybe":""},d.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return d.nativeSourceHandler.canPlayType(e.type);if(e.src){var o=/facebook.com/.test(e.src)?"video/facebook":"";return d.nativeSourceHandler.canPlayType(o)}return""},d.nativeSourceHandler.handleSource=function(e,t,o){t.setSrc(e.src)},d.nativeSourceHandler.dispose=function(){},d.registerSourceHandler(d.nativeSourceHandler),d.apiReadyQueue=[],"undefined"!=typeof document){var l=document.createElement("div");l.setAttribute("id","fb-root"),document.body.insertBefore(l,document.body.firstChild),n="https://connect.facebook.net/en_US/sdk.js",a=function(){window.fbAsyncInit=function(){FB.init({appId:"",xfbml:!0,version:"v3.2"})},d.isApiReady=!0;for(var e=0;e<d.apiReadyQueue.length;++e)d.apiReadyQueue[e].initFacebookPlayer()},s=!1,r=document.createElement("script"),(c=document.getElementsByTagName("script")[0]).parentNode.insertBefore(r,c),r.onload=function(){s||(s=!0,a())},r.onreadystatechange=function(){s||"complete"!==this.readyState&&"loaded"!==this.readyState||(s=!0,a())},r.src=n,t=".vjs-facebook iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }.vjs-facebook .vjs-iframe-blocker { display: none; }.vjs-facebook.vjs-has-started.vjs-user-inactive .vjs-iframe-blocker { display: block; }.vjs-facebook:not(.vjs-has-started) .vjs-poster, .vjs-facebook:not(.vjs-has-started) .vjs-big-play-button { pointer-events: none; }.vjs-facebook .vjs-poster { background-size: cover; }.vjs-no-poster:not(.vjs-ended) .vjs-big-play-button { display: none; }",o=document.head||document.getElementsByTagName("head")[0],(i=document.createElement("style")).type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),o.appendChild(i)}return d.VERSION="1.0.0",f.registerTech("Facebook",d),d});
